<!doctype html>
<html>

<head>

  <script type="text/template" id="size_option">
    <select class="size_option">
    <option value="1">1</option>
    <option value="0.25">Quarter</option>
    <option value="0.5">Half</option>
    
    <option value="0.1666666666">Sixth</option>
    <option value="0.125">Eighth</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    </select>
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"></script>

  <script>
    $(function() {
      var items = {
        "glue_dots": {
          "quantity": 200,
          "price": 1
        },
        "boxboard": {
          quantity: 100,
          price: 14.00
        },
        "ribbon": {
          "quantity": 40,
          "price": 1.95
        },
        "pearlescent_card": {
          "quantity": 100,
          "price": 25.90
        },
        "pearlescent_paper": {
          "quantity": 100,
          "price": 21.60
        },
        "white_card_400": {
          "quantity": 100,
          "price": 16.80
        },
        "white_card_200": {
          "quantity": 30,
          "price": 1
        },
        "tissue_paper": {
          "quantity":500,
          "price": 7.95
        },
        "vellum": {
          "quantity": 500,
          "price": 25.70
        },
        "diamante_heart": {
          "quantity": 50,
          "price": 12.98
        },
        "diamante_circle": {
          "quantity": 50,
          "price": 16.60
        },
        "diamante_buckle": {
          "quantity": 50,
          "price": 16.60
        },
        "acrylic_buckle": {
          "quantity": 100,
          "price": 1.95
        },
        "acrylic_heart": {
          "quantity": 50,
          "price": 2.95
        },
        "linen_300": {
          "quantity": 100,
          "price": 21.80
        },
        "kraft_300": {
          "quantity": 100,
          "price": 21.60
        },
        "linen_paper": {
          "quantity": 100,
          "price": 9.68
        },
        "hammered_300": {
          "quantity": 100,
          "price": 9.65,
          "supplier": "papercard.co.uk",
          "url": "https://www.papercard.co.uk/a4_white_hammer_effect_card"
        },
        "hammered_paper": {
          "quantity": 100,
          "price": 8.57,
          "supplier": "papercard.co.uk",
          "url": "https://www.papercard.co.uk/a4_white_hammer_effect_paper_100gsm"
        }
      }

      var ItemForCalculation = Backbone.Model.extend({
        initialize: function() {
          this.on("change", this.calculate)
        },
        calculate: function() {
          if (this.get("type")) {
            var information = items[this.get("type")]
            var cost = (information.price / information.quantity) * this.get("size")
            this.set("cost", cost)
          }
        },
        defaults: {
          "size": 1
        }
      })
      var ItemsForCalculation = Backbone.Collection.extend({
        model: ItemForCalculation,
        initialize: function() {
          this.on("change", this.totalCalculation)
        },
        totalCalculation: function() {
          var total = 0;
          this.map(function(item) {
            total = total + (item.get("cost"));
          })
          if ($('#quantity').val()) {
            total = total * $('#quantity').val()
          }
          $('#total').html(total)

        }
      })

      var items_for_calculation = new ItemsForCalculation();

      var FormView = Backbone.View.extend({
        initialize: function() {
          this.model = items_for_calculation.add({})
          this.listenTo(this.model, "change:cost", this.renderCost)
        },
        events: {
          'change .size_option': 'changeSize',
          "change .type": "changeType"
        },
        changeSize: function(e) {
          var size = $(e.currentTarget).val()
          this.model.set("size", size)
        },
        changeType: function(e) {
          var type = $(e.currentTarget).val()
          this.model.set("type", type)
        },
        renderCost: function() {
          this.$('.cost').html(this.model.get("cost"))
        },
        render: function() {
          this.$el.html("<select class='type'></select>")
          for (var key in items) {
            this.$('select').append("<option value='" + key + "'>" + key + "</option>")
          }
          var template = _.template($('#size_option').html())

          this.$el.append(template())
          this.$el.append("<div class='cost'></div>")

          this.$el.append("<div class='name' contenteditable='true'>name</div>")
          return this;
        }

      })
      var fv = new FormView().render();
      $('#options').html(fv.el)

      $('#add').click(function() {
        var fv = new FormView().render();
        $('#options').append(fv.el)
      })
    })
  </script>

</head>

<div id="options"></div>
<div id="add">Add new</div>

<input type="text" id="quantity"></input>
<div id="total"></div>

</html>